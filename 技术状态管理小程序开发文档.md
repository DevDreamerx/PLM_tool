# 技术状态管理小程序开发文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 项目名称 | 技术状态管理助手 |
| 版本号 | V1.0 |
| 文档状态 | 正式发布 |
| 适用范围 | 内网Windows 7平台 |

---

## 第一章 项目概述

### 1.1 项目背景

随着产品技术状态的日益复杂化，传统的手工记录和纸质档案管理方式已难以满足现代技术管理的需求。产品技术状态涉及设计文件、软件版本、硬件配置、更改履历等多维度信息，这些信息之间存在复杂的关联关系，需要进行规范化、系统化的管理。手工管理方式不仅效率低下，而且容易出现信息遗漏、版本混淆、追溯困难等问题，严重影响产品质量管理水平和问题定位效率。

为了提升技术状态管理的信息化水平，实现产品技术状态的数字化管理、快速检索和追溯分析，需要开发一款专门的技术状态管理小程序。该程序将运行于内网Windows 7环境，为技术管理人员、研发工程师、质量工程师等用户提供便捷的技术状态信息管理工具，支撑产品全生命周期的技术状态追踪与管理决策。

### 1.2 项目目标

本项目的核心目标是构建一款运行稳定、操作便捷、功能完备的技术状态管理桌面应用程序，具体目标包括以下四个方面。

第一，实现技术状态信息的规范化录入。程序提供结构化的数据录入界面，支持产品标识、技术参数、版本信息、更改履历等各类技术状态要素的规范化录入，确保数据完整性和一致性。通过表单校验机制，避免录入错误和遗漏，提高数据质量。

第二，建立本地化的数据存储机制。程序采用SQLite数据库作为数据存储引擎，在本地文件系统生成单一的数据库文件，实现数据的持久化存储。数据库设计遵循规范化原则，确保数据完整性和查询效率。同时提供数据备份和恢复功能，保障数据安全。

第三，提供高效的检索查询功能。程序支持多维度、多条件的组合查询，包括模糊搜索、精确匹配、时间范围筛选等功能，满足不同场景下的查询需求。查询结果支持分页浏览、排序调整、详情查看等操作，实现技术状态的快速定位和追溯。

第四，生成基础数据报表功能。程序提供数据统计和报表生成功能，以可视化方式展示产品技术状态的分布情况、变更趋势等关键指标，支持数据导出为Excel格式，便于汇报和分析。

### 1.3 用户群体

本程序面向以下几类用户群体，各群体的使用场景和需求重点有所不同。

技术管理人员是本程序的主要用户群体，他们负责产品技术状态的日常维护和管理工作。这类用户需要频繁进行技术状态信息的录入、修改和查询操作，对数据完整性和操作便捷性有较高要求。程序需要提供清晰的数据校验提示和便捷的批量操作功能，帮助技术管理人员高效完成日常工作。

研发工程师也是重要的用户群体，他们需要查询特定产品的技术状态信息，了解产品的软件版本、硬件配置等技术参数。这类用户对查询速度和结果准确性有较高要求，程序需要提供快速的检索功能和详细的技术状态展示界面，支持研发人员进行问题定位和技术分析。

质量工程师同样需要使用本程序，他们关注产品技术状态的变更历史和合规性审查。程序需要提供完整的变更追溯功能，记录每次技术状态变更的时间、内容和依据，支持质量工程师进行质量追溯和合规审计。

### 1.4 运行环境

本程序的运行环境受到内网Windows 7平台的特定约束，需要在软件设计和开发过程中予以充分考虑。

硬件环境方面，程序应能够在配置较低的Windows 7机器上流畅运行。建议最低配置为Intel Core 2 Duo处理器、2GB内存、20GB硬盘空间。程序启动时间应控制在5秒以内，内存占用不应超过200MB。存储空间需求主要来自数据库文件和数据备份，预计单个数据库文件大小不超过100MB（存储10万条记录）。

软件环境方面，目标操作系统为Windows 7（SP1及以上版本）。程序应确保与系统自带组件的兼容性，不依赖可能缺失的运行库。考虑到内网环境的隔离性，程序应完全离线运行，不进行任何网络请求。第三方依赖库应通过PyInstaller打包进可执行文件，无需用户单独安装。

### 1.5 约束条件

本项目在实施过程中需要遵守以下约束条件。

技术约束方面，程序必须使用Python 3.8版本进行开发，以确保持续在Windows 7环境下的兼容性。界面开发框架限定为PyQt5，避免使用WebView等可能存在兼容性问题的组件。数据库选用SQLite，单文件存储，便于数据备份和系统迁移。

部署约束方面，程序最终交付形态为单文件可执行程序（.exe），用户双击即可运行，无需安装过程。程序运行不依赖网络环境，完全在本地完成所有功能。数据存储在程序所在目录或用户指定目录，不修改系统注册表和关键系统文件。

时间约束方面，项目应在揭榜任务规定的时间内完成开发、测试和交付。考虑到运行环境验证的复杂性，应预留充足的时间进行Windows 7环境下的兼容性测试和问题修复。

---

## 第二章 需求说明

### 2.1 功能需求

#### 2.1.1 技术状态要素录入功能

技术状态要素录入是程序的核心功能之一，负责将产品技术状态信息规范化地录入系统。该功能需要提供友好的用户界面和完善的数据校验机制，确保录入数据的完整性和准确性。

录入界面应采用分组式布局，将相关字段归类组织，便于用户理解和填写。必填字段应有明确标识（如红色星号），选填字段应有适当提示。界面应支持键盘导航操作，用户可通过Tab键在不同输入框之间切换，提高录入效率。

数据校验应覆盖以下场景：必填项完整性检查，确保产品代号、产品名称、批次编号、图号、图纸版本等关键字段不为空；格式合规性检查，确保日期字段格式正确、数值字段为有效数字；唯一性校验，确保产品代号不重复录入，如存在重复应提示用户选择更新而非新建。

录入完成后，程序应支持两种保存方式：暂存和提交。暂存的记录保存为草稿状态，可随时修改完善；提交的记录保存为正式状态，进入查询和追溯系统。两种状态的记录应能区分显示，便于用户管理。

#### 2.1.2 数据库生成与管理功能

数据库生成与管理功能负责数据的持久化存储和安全管理，是程序数据层的核心支撑。

数据库初始化方面，程序首次启动时应自动检测数据库文件的存在性。如不存在，应在程序目录或用户指定目录创建SQLite数据库文件（tsm_data.db），并根据预定义的表结构自动创建数据表。初始化过程应静默完成，无需用户干预，同时提供明确的初始化完成提示。

数据表结构应支持产品技术状态的完整信息存储，包括产品基本信息、技术参数、版本信息、更改履历等。字段设计应考虑查询效率，对高频查询字段建立索引。同时预留扩展字段，支持未来功能扩展。

数据备份方面，程序应提供手动备份和自动备份两种机制。手动备份允许用户随时将数据库导出为备份文件；自动备份在程序退出时自动执行，将当前数据库复制到备份目录。备份文件应包含时间戳命名，便于版本追溯和管理。自动备份策略应支持配置，包括是否启用自动备份、备份目录位置、保留天数等参数。

#### 2.1.3 快速查找与追溯功能

快速查找与追溯功能是满足用户日常查询需求的核心功能，需要提供灵活高效的检索能力和直观的展示方式。

模糊检索功能支持对产品代号、产品名称、图号等关键字段进行模糊搜索。用户输入关键词片段后，系统实时显示匹配结果列表，无需点击查询按钮即可获得即时反馈。检索算法应考虑匹配度排序，将最相关的结果排在前面。查询响应时间应控制在1秒以内，确保用户体验流畅。

高级筛选功能支持多条件组合查询，用户可按产品型号、录入时间范围、记录状态（草稿或正式）等维度进行精确筛选。筛选条件以折叠面板形式组织，默认收起以保持界面简洁，展开后设置各项筛选参数。多个筛选条件之间支持逻辑与（AND）运算。

查询结果展示采用分页表格形式，每页显示固定数量（可配置，如20条或50条）的记录。表格应支持列宽调整、列顺序调整、排序等交互操作。每行记录应有操作列，提供"查看详情"、"编辑"、"删除"等快捷操作入口。

详情查看功能以弹窗或侧边栏形式展示产品技术状态的完整信息，包括基本信息、技术参数、版本信息、更改履历等。详情页面应同时展示该产品的变更历史时间线，记录每次状态变更的时间、内容和操作者，支持技术状态的完整追溯。

#### 2.1.4 数据报表功能

数据报表功能提供数据统计和可视化展示，帮助用户了解产品技术状态的整体情况。

数据统计卡片以数字形式展示关键统计指标，包括总记录数、本月新增数、待处理草稿数等。统计数据应实时更新，反映数据库中的最新状态。

可视化图表采用柱状图形式展示产品按型号的分布情况，使用PyQt5内置的图表组件或集成Matplotlib绘制。图表应支持交互操作，如鼠标悬停显示详细数值、点击图例切换系列显示等。

变更记录列表展示最近的变更动态，包括最近10条记录的变更时间、产品代号、变更类型和操作者，便于用户了解最新的技术状态变更情况。

数据导出功能支持将查询结果导出为Excel格式，保留原始表格结构和数据内容。导出文件自动添加时间戳命名，包含页眉页脚信息，便于打印和归档。

#### 2.1.5 系统设置功能

系统设置功能允许用户配置程序的运行参数和个性化选项。

数据库路径配置显示当前数据库文件的路径，并支持用户选择其他位置存储数据库。路径变更后程序应自动重启以应用新配置。

备份策略配置允许用户设置自动备份的开关、备份目录和保留天数。用户可选择是否启用程序退出时自动备份，设置备份文件的存放位置，配置备份文件的保留策略（如只保留最近7天或10天的备份）。

### 2.2 非功能需求

#### 2.2.1 性能需求

程序应具备良好的响应性能，确保用户操作的流畅性和工作效率。在性能方面应满足以下指标：程序启动时间不超过5秒，从双击图标到主界面完全加载完成；模糊查询响应时间不超过1秒，在10万条记录规模下仍保持良好性能；页面切换无明显卡顿，动画过渡流畅自然；内存占用稳定，长时间运行无内存泄漏。

#### 2.2.2 兼容性需求

程序应与目标运行环境保持良好兼容，确保在各种配置的Windows 7机器上正常运行。兼容性方面应满足以下要求：支持Windows 7 SP1及以上版本，包括32位和64位系统；支持1024×768至1920×1080的各种分辨率；界面元素在不同分辨率下正确显示和布局；程序运行不依赖特定系统组件或运行库。

#### 2.2.3 可靠性需求

程序应具备高可靠性，确保数据安全和系统稳定。可靠性方面应满足以下要求：程序异常退出时不应造成数据库损坏，SQLite事务机制确保数据完整性；提供数据恢复机制，备份文件可用于恢复数据库；表单提交时进行数据校验，避免无效数据入库；关键操作提供确认提示，防止误操作。

#### 2.2.4 可维护性需求

程序代码应具备良好的可维护性，便于后续功能扩展和问题修复。可维护性方面应满足以下要求：采用模块化设计，界面、数据、业务逻辑分层清晰；代码注释完整，关键函数和复杂逻辑有详细说明；遵循Python编码规范，命名规范统一；提供用户使用手册和技术文档。

### 2.3 界面需求

#### 2.3.1 整体布局

程序主窗口采用经典的三栏布局设计，兼顾功能完整性和操作便捷性。

左侧导航栏位于窗口左侧，宽度约200像素，显示功能模块导航列表。导航项采用图标加文字形式，支持高亮显示当前选中项。导航栏支持折叠最小化，扩大内容区域面积。默认显示"状态录入"、"状态查询"、"数据报表"、"系统设置"四个功能入口。

右侧内容区占据窗口主体区域，根据当前选中的功能模块显示相应界面。内容区采用QStackedWidget组件实现多页面切换，支持动画过渡效果。内容区背景色采用浅灰色，减少视觉疲劳。

底部状态栏位于窗口底部，高度约30像素，显示程序运行状态信息。状态栏从左至右依次显示当前数据库路径、记录数量统计、程序版本号等信息。状态栏信息实时更新，反映最新状态。

#### 2.3.2 色彩与样式

界面配色采用专业、简洁的设计风格，营造高效、舒适的办公氛围。

主色调为科技蓝（#1890FF），用于主要按钮、重要操作入口、当前选中项高亮、链接文字等场景。科技蓝传达专业、可信的品牌形象，适合企业级办公软件使用。

辅助色系包括：成功绿色（#52C41A）用于有效状态指示、成功提示信息；警告橙色（#FAAD14）用于待处理事项、暂存状态提示；错误红色（#F5222D）用于错误提示、删除确认等警示场景；信息蓝色（#1890FF）用于普通提示信息和链接。

背景色采用浅灰白（#F5F7FA），用于主窗口背景、内容区域背景，降低视觉对比度，减少长时间使用的视觉疲劳。面板背景采用纯白色（#FFFFFF），用于表单容器、卡片组件等，形成层次感。

文字颜色采用语义化设计：主要文字（#333333）用于标题、表单标签等需要突出的内容；次要文字（#666666）用于提示信息、时间显示等辅助内容；占位文字（#999999）用于输入框占位提示、禁用状态文字。

#### 2.3.3 组件规范

输入组件方面，文本输入框采用统一高度（约32像素），支持placeholder提示，聚焦时显示蓝色边框。必填项输入框右侧显示红色星号标识。日期选择器使用QDateEdit组件，支持键盘输入和日历弹出选择。下拉选择框使用QComboBox，支持键盘搜索和历史输入记录。

按钮组件方面，主要操作按钮采用填充样式（蓝色背景白色文字），尺寸约32×80像素；次要操作按钮采用边框样式（透明背景蓝色边框），尺寸约32×80像素；警告操作按钮（如删除）采用危险样式（红色背景白色文字）；按钮组支持禁用状态显示，禁用时变灰且不可点击。

表格组件方面，数据表格采用斑马纹行背景（白色和浅灰色交替），表头深色背景高亮显示。表头支持点击排序，默认左对齐显示文本内容。行高固定约40像素，支持列宽拖拽调整。表格底部显示分页控件，包括页码导航和每页显示数量选择。

弹窗组件方面，消息提示弹窗（MessageBox）用于显示操作结果和提示信息，标题清晰、按钮明确。详情展示弹窗用于显示产品技术状态的完整信息，采用表单布局，右键菜单支持复制内容。确认弹窗用于删除等不可逆操作的二次确认，明确提示操作后果。

---

## 第三章 技术方案

### 3.1 技术选型

#### 3.1.1 开发语言

本程序选用Python作为开发语言，主要基于以下考量。

Python语言在Windows 7环境下具有良好的兼容性。Python官方支持的最高版本为3.8.x，能够在Windows 7 SP1系统上稳定运行。Python生态丰富，拥有大量成熟的数据处理和界面开发库，能够满足本项目的功能需求。Python语法简洁易读，开发效率高，能够在有限时间内完成开发任务。

相比其他可选语言（如Node.js或C#），Python更适合本项目的场景。Node.js在Windows 7环境下支持的最高版本较低，且部分新特性无法使用；C#虽然Windows原生支持较好，但开发和打包流程相对复杂。综合考虑开发效率、运行性能、兼容性要求，Python是最佳选择。

#### 3.1.2 界面框架

本程序选用PyQt5作为界面开发框架，主要基于以下考量。

PyQt5是Qt框架的Python绑定，提供了丰富的桌面应用组件和强大的界面定制能力。PyQt5组件运行性能接近原生应用，界面响应速度快，用户体验良好。PyQt5不依赖WebView等可能存在兼容性问题的组件，确保在Windows 7环境下的稳定运行。

PyQt5的布局管理系统支持响应式设计，能够自适应不同分辨率和窗口尺寸。Qt Style Sheets（QSS）支持CSS样式定制，便于实现统一的界面风格。PyQt5的事件处理机制完善，支持键盘、鼠标、触摸等多种交互方式。

#### 3.1.3 数据库

本程序选用SQLite作为数据存储引擎，主要基于以下考量。

SQLite是轻量级的嵌入式数据库引擎，整个数据库存储在单一文件中，无需安装数据库服务软件。这完美契合内网环境下的离线使用需求，数据备份仅需复制文件即可完成。SQLite零配置特性，程序首次启动自动完成数据库初始化。

SQLite性能足以满足本项目的需求。对于10万条记录规模，查询响应时间在毫秒级别。SQLite支持完整的事务机制，确保数据操作的原子性、一致性、隔离性和持久性。SQLite支持标准SQL语法，学习成本低，代码可维护性好。

#### 3.1.4 打包工具

本程序选用PyInstaller作为打包工具，将Python程序和所有依赖打包为单文件可执行程序。

PyInstaller支持Windows平台，能够将Python脚本打包为独立的.exe文件。打包后的程序无需安装Python环境，双击即可运行，非常适合内网环境下的分发部署。PyInstaller支持将所有依赖（包括PyQt5、SQLite驱动等）打包进单个文件，简化部署流程。

打包配置需要注意以下事项：使用--onefile参数生成单文件；使用--windowed参数避免控制台窗口闪烁；通过--hidden-import指定需要隐藏导入的模块；通过--collect-all或--datas包含必要的数据文件。

### 3.2 架构设计

#### 3.2.1 总体架构

本程序采用经典的三层架构设计，自下而上依次为数据访问层、业务逻辑层和表现层。

数据访问层（Data Access Layer）负责数据库的创建、连接和SQL操作封装。该层对上层屏蔽数据库访问细节，提供简洁的数据操作接口。核心组件为DatabaseManager类，封装所有数据库CRUD操作。

业务逻辑层（Business Logic Layer）负责处理程序的核心业务规则和流程控制。该层调用数据访问层完成数据持久化，同时进行数据验证和业务规则校验。核心组件包括ProductManager、QueryManager等业务管理类。

表现层（Presentation Layer）负责用户界面展示和交互处理。该层基于PyQt5构建图形界面，响应用户操作，调用业务逻辑层完成数据处理。核心组件包括各功能模块的Widget类和主窗口MainWindow类。

三层之间通过明确定义的接口进行通信，层与层之间保持松耦合关系。这种设计便于单元测试、代码维护和功能扩展。

#### 3.2.2 目录结构

程序源代码组织为以下目录结构：

```
tech_status_manager/
├── main.py                      # 程序入口文件
├── requirements.txt             # 依赖包清单
├── README.md                    # 用户使用手册
├── db/
│   ├── __init__.py
│   └── database.py              # 数据库操作模块
├── ui/
│   ├── __init__.py
│   ├── main_window.py           # 主窗口类
│   ├── entry_widget.py          # 状态录入界面
│   ├── query_widget.py          # 状态查询界面
│   ├── report_widget.py         # 数据报表界面
│   └── settings_widget.py       # 系统设置界面
├── utils/
│   ├── __init__.py
│   ├── excel_exporter.py        # Excel导出工具
│   ├── backup.py                # 备份工具
│   └── message_box.py           # 消息提示框
└── resources/
    ├── icons/                   # 图标资源
    └── styles/                  # 样式文件
```

### 3.3 数据库设计

#### 3.3.1 数据库概述

本程序使用SQLite数据库存储所有技术状态相关数据。数据库文件名为tsm_data.db，存储在程序目录或用户指定目录。数据库设计遵循第三范式，减少数据冗余，提高数据一致性。

数据库包含三个核心数据表：产品信息表（product）存储产品的基本标识信息；技术状态表（tech_status）存储产品的详细技术状态信息；变更历史表（change_log）存储技术状态的变更记录。此外，数据库还包含若干索引，用于提高查询效率。

#### 3.3.2 数据表设计

**产品信息表（product）**

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | INTEGER | PRIMARY KEY | 自增主键 |
| product_code | TEXT | UNIQUE NOT NULL | 产品代号，唯一标识 |
| product_name | TEXT | NOT NULL | 产品名称 |
| batch_number | TEXT | NOT NULL | 批次编号 |
| model | TEXT | NOT NULL | 所属型号 |
| status | TEXT | DEFAULT 'active' | 状态：active/inactive |
| created_at | DATETIME | NOT NULL | 创建时间 |
| updated_at | DATETIME | NOT NULL | 更新时间 |

产品信息表是整个数据库的核心表，存储产品的基本标识信息。产品代号（product_code）作为业务主键，唯一标识一个产品，在录入时进行唯一性校验。状态字段（status）标记产品是否有效，支持软删除逻辑。创建时间和更新时间字段用于审计追踪。

**技术状态表（tech_status）**

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | INTEGER | PRIMARY KEY | 自增主键 |
| product_id | INTEGER | NOT NULL, FOREIGN KEY | 关联产品ID |
| drawing_number | TEXT | NOT NULL | 图号 |
| drawing_version | TEXT | NOT NULL | 图纸版本 |
| software_version | TEXT | | 软件版本 |
| firmware_version | TEXT | | 固件版本 |
| hardware_config | TEXT | | 硬件配置（JSON格式） |
| change_order | TEXT | | 更改单号 |
| change_description | TEXT | | 更改内容摘要 |
| effective_date | DATE | | 生效日期 |
| created_at | DATETIME | NOT NULL | 创建时间 |

技术状态表存储产品的详细技术状态信息，通过product_id外键关联产品信息表。一对一的设计确保产品技术状态的清晰管理。硬件配置字段采用JSON格式存储，支持灵活的键值对结构，便于存储不同产品的个性化配置。

**变更历史表（change_log）**

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | INTEGER | PRIMARY KEY | 自增主键 |
| tech_status_id | INTEGER | NOT NULL, FOREIGN KEY | 关联技术状态ID |
| change_type | TEXT | NOT NULL | 变更类型：create/update/view |
| change_content | TEXT | NOT NULL | 变更内容描述 |
| operator | TEXT | NOT NULL | 操作人员 |
| created_at | DATETIME | NOT NULL | 操作时间 |

变更历史表记录技术状态的完整变更轨迹，支持追溯分析。变更类型区分新建、更新、查看等操作，便于后续审计。操作人员字段记录执行变更的用户标识，支持多用户场景。

#### 3.3.3 索引设计

为提高查询性能，在以下字段上创建索引：

- product表的product_code字段创建唯一索引，加速产品代号查询
- product表的model字段创建普通索引，支持按型号筛选
- tech_status表的product_id字段创建普通索引，加速关联查询
- change_log表的tech_status_id字段创建普通索引，加速变更历史查询
- change_log表的created_at字段创建普通索引，支持按时间排序

---

## 第四章 功能模块详细设计

### 4.1 主窗口模块

#### 4.1.1 功能描述

主窗口模块是程序的入口和容器，负责组织和管理各功能模块的显示与切换。主窗口采用分栏布局，左侧为导航栏，右侧为内容区，底部为状态栏。程序启动时自动加载主窗口，并根据配置恢复上次的窗口尺寸和位置。

#### 4.1.2 类设计

MainWindow类继承自QMainWindow，是程序的主窗口组件。

类属性包括nav_list（导航列表组件）、stack（页面栈组件）、menubar（菜单栏组件）和statusbar（状态栏组件）。

核心方法包括：init_ui方法完成界面初始化，包括创建导航栏、内容区，设置布局；switch_page方法响应导航栏切换事件，根据当前选中项切换显示的页面；update_status方法更新状态栏信息，显示数据库路径和记录数量；closeEvent方法处理窗口关闭事件，执行数据备份等收尾工作。

#### 4.1.3 交互逻辑

程序启动时，MainWindow的构造函数被调用，完成界面初始化。init_ui方法首先创建导航栏组件，添加"状态录入"、"状态查询"、"数据报表"、"系统设置"四个导航项；然后创建页面栈组件，实例化四个功能模块的Widget并添加到栈中；最后组装布局，设置主窗口的标题、图标、最小尺寸等属性。

导航栏的currentRowChanged信号连接到switch_page方法。当用户点击不同的导航项时，switch_page方法获取当前选中行的索引，调用页面栈的setCurrentIndex方法切换显示的页面。页面切换时，当前页面的数据会刷新，确保显示最新状态。

窗口关闭时，closeEvent方法被调用。该方法首先检查是否需要执行自动备份，如启用则调用备份工具执行数据库备份；然后保存窗口尺寸和位置到配置文件；最后调用父类的closeEvent方法完成关闭操作。

### 4.2 状态录入模块

#### 4.2.1 功能描述

状态录入模块负责产品技术状态信息的录入和保存。该模块提供结构化的表单界面，支持必填项校验和唯一性校验，提供暂存和提交两种保存方式。录入完成后，用户可以继续录入新产品或查看已保存的记录。

#### 4.2.2 类设计

EntryWidget类继承自QWidget，是状态录入界面的主组件。

表单字段组件包括：product_code_edit（产品代号输入框）、product_name_edit（产品名称输入框）、batch_number_edit（批次编号输入框）、model_combo（型号下拉选择框）、drawing_number_edit（图号输入框）、drawing_version_edit（图纸版本输入框）、software_version_edit（软件版本输入框）、firmware_version_edit（固件版本输入框）、hardware_config_edit（硬件配置多行文本框）、change_order_edit（更改单号输入框）、change_desc_edit（更改内容摘要文本框）、effective_date_edit（生效日期选择器）。

按钮组件包括：save_draft_btn（暂存按钮）、submit_btn（提交按钮）、clear_btn（清空按钮）、view_drafts_btn（查看草稿按钮）。

核心方法包括：clear_form方法清空表单所有内容；validate_form方法校验表单数据，返回校验结果和错误信息；save_to_db方法将表单数据保存到数据库；load_product方法加载现有产品数据进行编辑。

#### 4.2.3 表单设计

表单采用网格布局（QGridLayout），将相关字段分组组织。布局结构如下：

第一行第一列和第二列放置产品代号和产品名称输入框；第三行和第四行放置批次编号和型号选择框；第五行至第七行放置图号和图纸版本输入框、软件版本和固件版本输入框；第八行放置硬件配置文本框（跨两列）；第九行和第十行放置更改单号和更改内容摘要输入框、日期选择器。

表单底部放置按钮组，包括暂存、提交、清空、查看草稿四个按钮。按钮采用水平布局（QHBoxLayout），居中对齐。

必填项（产品代号、产品名称、批次编号、图号、图纸版本）右侧显示红色星号标识。输入框设置placeholder提示，指导用户正确输入。

#### 4.2.4 交互逻辑

用户填写表单后，点击"暂存"按钮触发save_draft_btn的clicked信号。槽函数首先调用validate_form方法校验必填项，如校验失败则显示错误提示；如校验通过，则调用save_to_db方法将数据保存到数据库，记录状态为"draft"（草稿），显示保存成功提示，然后清空表单准备录入下一条记录。

点击"提交"按钮的交互流程与暂存类似，区别在于保存时记录状态为"active"（正式），表单校验更加严格，包括所有必填项的完整性检查。

点击"清空"按钮立即清空表单所有内容，无需确认。如用户已输入部分内容，清空前应显示确认对话框。

点击"查看草稿"按钮弹出草稿列表对话框，显示所有暂存的草稿记录。用户可以选择一条草稿加载到表单进行编辑，或删除不需要的草稿。

### 4.3 状态查询模块

#### 4.3.1 功能描述

状态查询模块提供产品技术状态的检索和查看功能。该模块支持模糊搜索和多条件组合筛选，查询结果以分页表格形式展示，支持查看详情、编辑、删除等操作。详情展示以弹窗形式呈现，包含完整的变更历史时间线。

#### 4.3.2 类设计

QueryWidget类继承自QWidget，是状态查询界面的主组件。

搜索组件包括：keyword_edit（关键字输入框）、search_btn（搜索按钮）、advanced_filter_group（高级筛选折叠面板）、model_combo（型号筛选下拉框）、status_combo（状态筛选下拉框）、start_date_edit（起始日期选择器）、end_date_edit（结束日期选择器）。

结果展示组件包括：result_table（结果表格）、pagination_widget（分页组件）。

核心方法包括：search方法执行搜索查询，更新结果表格；load_results方法将查询结果填充到表格；show_detail方法显示选中记录的详情信息；edit_record方法编辑选中记录；delete_record方法删除选中记录。

#### 4.3.3 搜索界面设计

搜索界面采用垂直布局（QVBoxLayout），从上到下依次为搜索栏、高级筛选面板、结果表格、分页组件。

搜索栏采用水平布局，包含关键字输入框和搜索按钮。关键字输入框设置placeholder提示"输入产品代号、名称或图号进行搜索"。搜索按钮旁可放置"高级筛选"按钮，点击展开或收起高级筛选面板。

高级筛选面板默认收起，点击"高级筛选"按钮展开。面板内包含型号下拉框、状态下拉框、起始日期和结束日期选择器。型号和状态下拉框包含"全部"选项。日期选择器支持空值，表示不限制时间范围。

#### 4.3.4 交互逻辑

用户输入关键字并点击"搜索"按钮后，search方法被调用。该方法首先获取搜索关键字和筛选条件，然后调用数据库查询模块执行搜索。搜索采用模糊匹配，对产品代号、产品名称、图号等多个字段进行OR条件匹配。

查询结果返回后，load_results方法将结果填充到表格。表格每行显示产品代号、产品名称、型号、图号、软件版本、创建时间和操作按钮。操作列包含"查看"、"编辑"、"删除"三个按钮，点击触发相应操作。

分页组件显示当前页码、总页数、记录总数，提供"首页"、"上一页"、"下一页"、"末页"导航按钮和页码输入框。切换页面时调用load_results方法加载对应页的数据。

点击"查看"按钮弹出详情对话框，调用show_detail方法显示选中记录的完整信息。详情对话框下方显示该产品的变更历史时间线，以垂直时间线形式展示历次变更记录。

### 4.4 数据报表模块

#### 4.4.1 功能描述

数据报表模块提供产品技术状态的统计分析和可视化展示功能。该模块以仪表盘形式展示关键统计指标，以柱状图展示产品型号分布，提供变更动态列表和数据导出功能。

#### 4.4.2 类设计

ReportWidget类继承自QWidget，是数据报表界面的主组件。

统计组件包括：total_count_label（总记录数标签）、monthly_count_label（本月新增标签）、draft_count_label（草稿数标签）。

图表组件包括：distribution_chart（型号分布柱状图）。

列表组件包括：recent_changes_list（最近变更列表）、export_btn（导出按钮）。

核心方法包括：refresh_stats方法刷新统计数据；render_chart方法绘制分布图表；load_recent_changes方法加载最近变更记录；export_to_excel方法导出查询结果为Excel。

#### 4.4.3 报表界面设计

报表界面采用网格布局，分为三个区域：顶部统计卡片区、中间图表区和底部变更列表区。

统计卡片区包含三个卡片组件，分别显示总记录数、本月新增数、待处理草稿数。卡片采用白色背景、圆角边框设计，左侧显示数字标签，右侧显示说明文字。

图表区显示产品按型号分布的柱状图。使用PyQt5的QChart组件或集成Matplotlib绑制。图表支持鼠标悬停交互，显示具体的数量数值。

变更列表区显示最近10条变更记录，每行显示变更时间、产品代号、变更类型、操作者。列表下方放置"导出"按钮，支持将当前查询结果导出为Excel文件。

### 4.5 系统设置模块

#### 4.5.1 功能描述

系统设置模块提供程序运行参数的配置功能。该模块允许用户配置数据库路径、备份策略等参数，配置信息保存到配置文件，程序重启后应用新配置。

#### 4.5.2 类设计

SettingsWidget类继承自QWidget，是系统设置界面的主组件。

配置组件包括：db_path_edit（数据库路径显示和选择）、backup_switch（自动备份开关）、backup_path_edit（备份路径显示和选择）、backup_days_spinner（保留天数输入框）、manual_backup_btn（手动备份按钮）、restore_backup_btn（恢复备份按钮）。

核心方法包括：load_settings方法从配置文件加载设置；save_settings方法保存设置到配置文件；select_db_path方法选择数据库路径；select_backup_path方法选择备份路径；do_backup方法执行手动备份；do_restore方法执行备份恢复。

#### 4.5.3 设置界面设计

设置界面采用分组式布局，分为"数据库设置"组和"备份设置"组。

数据库设置组包含数据库路径显示框和"选择路径"按钮。路径显示框为只读，显示当前数据库文件的完整路径。用户点击"选择路径"按钮弹出目录选择对话框，选择后程序提示需要重启应用。

备份设置组包含自动备份开关（QCheckBox）、备份路径显示框和"选择路径"按钮、保留天数输入框（QSpinBox）、"立即备份"和"恢复备份"按钮。自动备份开关状态变化时触发设置保存。保留天数设置范围为1至30天。

---

## 第五章 数据库操作模块

### 5.1 数据库管理器

#### 5.1.1 功能描述

DatabaseManager类是数据库操作的核心封装类，负责数据库的连接管理、初始化、CRUD操作等。该类对上层业务逻辑层屏蔽数据库访问细节，提供简洁的数据操作接口。

#### 5.1.2 核心方法

init_db方法负责数据库初始化。方法首先检测数据库文件是否存在，如不存在则创建；然后连接数据库，创建数据表；最后创建索引。数据表创建使用CREATE TABLE IF NOT EXISTS语句，支持程序升级时的表结构更新。

get_connection方法返回数据库连接对象。每次调用创建新连接，使用完毕后由调用者关闭。建议使用with语句管理连接，确保资源正确释放。

execute方法执行单条SQL语句，用于INSERT、UPDATE、DELETE等操作。方法封装参数绑定，防止SQL注入攻击。

execute_many方法执行多条SQL语句，用于批量数据操作。方法支持事务，提高批量操作效率。

query方法执行查询SQL，返回结果集。支持参数绑定和结果集迭代。

#### 5.1.3 业务操作方法

insert_product方法插入新产品记录。方法接收产品信息字典作为参数，返回插入记录的自增ID。如产品代号已存在，方法抛出异常，由上层处理重复校验。

update_product方法更新产品信息。方法接收产品ID和更新信息字典作为参数，更新指定记录。更新时自动设置updated_at字段为当前时间。

get_product方法根据产品ID或产品代号获取产品信息。方法返回产品信息字典，如未找到返回None。

search_products方法搜索产品。方法接收关键字和筛选条件作为参数，返回匹配的产品列表。结果支持分页，返回总记录数和当前页数据。

insert_tech_status方法插入技术状态记录。方法接收技术状态信息字典和关联产品ID作为参数。

get_tech_status方法根据产品ID获取技术状态信息。

insert_change_log方法插入变更历史记录。方法记录变更类型、变更内容、操作者和时间。

get_change_history方法根据技术状态ID获取完整的变更历史记录。

### 5.2 备份工具

BackupManager类负责数据库的备份和恢复操作。

backup方法执行数据库备份。方法首先检查源数据库是否存在；然后复制数据库文件到备份目录；最后清理过期备份文件。备份文件名包含时间戳，格式为tsm_data_YYYYMMDD_HHMMSS.db。

restore方法执行备份恢复。方法首先列出备份目录中的备份文件；然后让用户选择要恢复的备份；最后复制备份文件替换当前数据库。恢复操作不可逆，执行前应提示用户确认。

list_backups方法列出所有可用备份。方法返回备份文件列表，按时间戳降序排列。

### 5.3 Excel导出工具

ExcelExporter类负责将查询结果导出为Excel文件。

export方法执行导出操作。方法接收数据列表和文件路径作为参数，使用openpyxl库创建Excel工作簿。导出内容包括表头和数据行，自动设置列宽，应用单元格样式。导出完成后提示用户文件保存位置。

---

## 第六章 开发规范

### 6.1 代码规范

#### 6.1.1 命名规范

本项目Python代码遵循以下命名规范。

类名采用大驼峰命名法（PascalCase），如MainWindow、EntryWidget、DatabaseManager。文件名采用小写下划线分隔（snake_case），如main_window.py、excel_exporter.py。

变量名和函数名采用小写下划线分隔（snake_case），如product_code、get_connection、search_products。常量名采用全大写下划线分隔（UPPER_Snake_CASE），如DEFAULT_PAGE_SIZE、BACKUP_DIRECTORY。

私有方法和属性以单下划线前缀开头，如_init_db、_validate_form。

#### 6.1.2 注释规范

代码注释使用中文，确保团队成员易于理解。注释类型包括以下几种。

文件注释位于每个Python文件开头，包含文件说明、作者、创建日期、版本信息。类注释位于类定义之后，说明类的用途和主要方法。方法注释位于方法定义之后，说明方法功能、参数、返回值和可能抛出的异常。行内注释用于解释复杂逻辑或计算表达式，避免过度注释。

```python
# -*- coding: utf-8 -*-
"""
主窗口模块

功能描述：程序主窗口，负责导航和页面管理

作者：MiniMax Agent
创建日期：2026-01-20
版本：1.0
"""

class MainWindow(QMainWindow):
    """主窗口类"""
    
    def switch_page(self, index):
        """切换显示的页面
        
        Args:
            index: 页面索引，对应导航栏的选中行
        """
        self.stack.setCurrentIndex(index)
```

#### 6.1.3 导入规范

导入语句分组组织，组间空行分隔。第一组导入Python标准库模块，第二组导入第三方库模块，第三组导入项目自定义模块。组内导入按字母顺序排列。

```python
import os
import sys
from datetime import datetime

from PyQt5.QtCore import Qt, QSize
from PyQt5.QtWidgets import (
    QApplication, QMainWindow, QWidget, 
    QListWidget, QStackedWidget, QTableWidget
)

from db.database import DatabaseManager
from utils.backup import BackupManager
```

### 6.2 界面开发规范

#### 6.2.1 布局规范

界面布局使用Qt布局管理器（QHBoxLayout、QVBoxLayout、QGridLayout），避免绝对定位。布局嵌套层次不宜过深，通常不超过3层。组件间距使用标准值：水平间距8像素，垂直间距8像素，边缘间距12像素。

表单类界面使用QFormLayout，标签和输入框自动对齐。表格类界面使用QTableWidget或QTableView，支持列宽调整和表头排序。

#### 6.2.2 样式规范

界面样式使用QSS（Qt Style Sheets）定义，与CSS语法类似。样式定义集中管理，存储在resources/styles目录下的QSS文件中，程序启动时加载。

```css
/* 主窗口样式 */
QMainWindow {
    background-color: #F5F7FA;
}

/* 导航栏样式 */
QListWidget {
    background-color: #FFFFFF;
    border: none;
    outline: none;
}

QListWidget::item {
    height: 48px;
    padding-left: 16px;
}

QListWidget::item:selected {
    background-color: #E6F7FF;
    color: #1890FF;
}

/* 按钮样式 */
QPushButton#primaryButton {
    background-color: #1890FF;
    color: #FFFFFF;
    border-radius: 4px;
    min-width: 80px;
    min-height: 32px;
}

QPushButton#primaryButton:hover {
    background-color: #40A9FF;
}
```

### 6.3 异常处理规范

程序应优雅处理各种异常情况，避免闪退和数据丢失。

数据库操作异常捕获SQLiteException，记录错误日志，向用户显示友好提示。表单验证失败显示具体的错误信息，指导用户修改输入。文件操作异常（如备份失败）提示用户检查路径权限和磁盘空间。未知异常记录堆栈信息，提示用户联系技术支持。

---

## 第七章 测试与验收

### 7.1 测试计划

#### 7.1.1 功能测试

功能测试覆盖所有功能模块的核心场景，确保功能实现符合需求规格。

状态录入功能测试包括：正常录入完整表单数据并成功保存；录入必填项缺失时显示错误提示；录入重复产品代号时显示警告提示；暂存后草稿列表正确显示；提交后数据进入正式查询系统。

状态查询功能测试包括：模糊搜索返回正确结果；多条件组合筛选结果正确；分页导航功能正常；查看详情显示完整信息；编辑功能正确加载和保存数据；删除功能正确移除数据。

数据报表功能测试包括：统计数据实时更新；图表正确显示产品分布；最近变更列表正确显示；Excel导出功能正常生成文件。

系统设置功能测试包括：数据库路径切换后程序正常重启；手动备份成功创建备份文件；自动备份在程序退出时正确执行；恢复备份功能正确恢复数据。

#### 7.1.2 性能测试

性能测试验证程序在目标运行环境下的响应性能。

启动性能测试验证程序启动时间不超过5秒。测试方法为连续启动程序10次，测量每次从双击图标到主界面完全加载的时间，计算平均值和最大值。

查询性能测试验证模糊查询响应时间不超过1秒。测试方法为生成10万条测试数据，执行模糊查询并计时，验证响应时间指标。

内存占用测试验证程序运行稳定。测试方法为使用任务管理器监控程序运行30分钟的内存占用变化，验证无内存泄漏。

#### 7.1.3 兼容性测试

兼容性测试验证程序在目标运行环境下的正常运行。

Windows 7兼容性测试在纯净版Windows 7 SP1虚拟机中安装运行程序，验证所有功能正常。测试不同配置（32位/64位、不同内存大小）的机器。

分辨率兼容性测试在不同分辨率（1024×768、1366×768、1920×1080）下验证界面显示正常，布局无错位。

离线环境测试在断开网络的环境下运行程序，验证所有功能正常，无网络请求超时。

### 7.2 验收标准

#### 7.2.1 功能验收标准

程序必须完整实现以下功能，且通过相应测试场景的验证。

能够成功录入一条完整的技术状态记录，包含产品代号、产品名称、批次编号、图号、图纸版本等必填字段。录入时表单校验功能正常，必填项缺失或格式错误时显示明确的错误提示。重复产品代号录入时正确提示用户选择更新而非新建。

录入的数据能够正确保存到数据库，数据库文件可在程序目录中找到。保存的记录可通过产品代号、产品名称、图号等关键字搜索出来。搜索结果准确、完整，响应时间符合性能要求。

查询结果可正确导出为Excel文件，导出的数据与查询结果一致。导出的Excel文件格式规范，可正常打开和编辑。

#### 7.2.2 性能验收标准

程序必须满足以下性能指标：启动时间不超过5秒；模糊查询响应时间不超过1秒（10万条数据规模）；内存占用稳定，长时间运行无明显增长；页面切换无明显卡顿，动画流畅。

#### 7.2.3 兼容性验收标准

程序必须在以下环境中正常运行：Windows 7 SP1 32位和64位版本；无网络连接的纯离线环境；1024×768及以上分辨率。

程序运行不依赖外部组件，无需安装额外运行库。打包后的.exe文件可复制到目标机器直接运行。

#### 7.2.4 文档验收标准

交付物必须包含以下文档：用户使用手册（README.md），包含功能说明、操作指南、常见问题等内容；源代码注释完整，关键类和函数有说明文档；目录结构清晰，代码组织规范。

---

## 第八章 部署与交付

### 8.1 打包部署

#### 8.1.1 打包命令

在开发环境中执行以下命令将程序打包为单文件可执行程序：

```bash
pyinstaller --onefile --windowed --name "技术状态管理助手" --icon=resources/icons/app.ico main.py
```

打包参数说明：--onefile参数指定生成单文件可执行程序；--windowed参数指定不显示控制台窗口；--name参数指定生成的.exe文件名；--icon参数指定程序图标。

#### 8.1.2 依赖清单

程序依赖以下第三方库，PyInstaller打包时会自动包含：

PyQt5>=5.15.0：界面开发框架；openpyxl>=3.0.0：Excel文件处理。

### 8.2 交付清单

交付物包括以下内容：

源代码目录包含完整的项目源代码，目录结构符合本文档规范。打包后的.exe文件为可直接运行的可执行程序。用户使用手册（README.md）包含程序功能介绍、操作指南、常见问题解答。快速入门指南提供最基本的使用说明，帮助用户快速上手。

### 8.3 安装部署

目标机器部署步骤如下：

第一步，将打包后的.exe文件复制到目标机器的任意目录。第二步，首次运行.exe文件，程序自动在同级目录创建数据库文件（tsm_data.db）和配置目录。第三步，如需更改数据库存储位置，可在系统设置中配置。

程序升级时，只需替换.exe文件，数据库文件保持不变。如需升级数据库结构，程序应提供数据库迁移机制。

---

## 附录

### 附录A 数据字典

本附录详细说明数据库各表的字段定义和数据类型。

产品信息表（product）存储产品的基本标识信息，是技术状态信息的核心关联表。product_code字段为业务主键，格式为字母数字组合，长度不超过50个字符。status字段有效值为active（有效）和inactive（无效），默认值为active。

技术状态表（tech_status）存储产品的详细技术状态信息，通过product_id外键关联产品信息表。hardware_config字段存储JSON格式的键值对数据，用于存储灵活的硬件配置信息。effective_date字段格式为YYYY-MM-DD日期格式。

变更历史表（change_log）存储技术状态的变更记录，通过tech_status_id外键关联技术状态表。change_type字段有效值为create（创建）、update（更新）、view（查看）。

### 附录B 版本历史

| 版本 | 日期 | 修改内容 | 作者 |
|------|------|----------|------|
| 1.0 | 2026-01-20 | 初始版本，发布正式版 | MiniMax Agent |

---

**文档结束**